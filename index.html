<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RenoChain — Watch the Full Video</title>
  <meta name="description" content="Unlock RenoChain's full-length video after a quick sign-up." />

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Video -->
  <link rel="preconnect" href="https://player.vimeo.com" crossorigin>
  <link rel="preconnect" href="https://i.vimeocdn.com" crossorigin>

  <style>
    :root{
    /* Light theme tuned to RenoChain greens */
    --ink:#0f1b14;          /* dark text on light bg */
    --bg1:#f5f7f6;          /* light (dim white) */
    --bg2:#eef1ef;          /* subtle second tone */
    --card:#ffffff;         /* cards/forms white */
    --glass:rgba(255,255,255,.82);
  
    --muted:#5e6b63;        /* muted gray-green for help text */
    --text:#0f1b14;         /* main text (dark) */
  
    /* Accents from logo */
    --accent1:#9bd84f;
    --accent2:#6cc24a;
    --accent3:#d9eba7;
  
    --ok:#15803d;           /* success green on light bg */
    --err:#b91c1c;          /* error on light bg */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:
      radial-gradient(800px 500px at 15% -10%, rgba(155,216,79,.12), transparent 55%),
      radial-gradient(700px 500px at 110% 10%, rgba(108,194,74,.10), transparent 55%),
      linear-gradient(160deg, var(--bg1), var(--bg2));
      color: var(--text);
    }
    .shell{max-width:1100px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;gap:18px;margin-bottom:24px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{
      max-height:60px;   /* 15% bigger but responsive */
      width:auto;
      border-radius:10px;
    }
    .brand h1{font-size:20px;margin:0}
    .tag{font-size:12px;color:var(--muted)}

    .hero{
      display:grid;grid-template-columns:1.2fr 1fr;gap:24px;align-items:stretch;
    }
    @media (max-width: 980px){.hero{grid-template-columns:1fr}}

    .teaser{
      position:relative;padding:22px;border-radius:18px;
      background: var(--card);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
    }
    .teaser::after{
      content:"";position:absolute;inset:-40% -20% auto auto;height:260px;width:260px;
      background:radial-gradient(circle at 30% 30%, rgba(34,211,238,.35), transparent 55%),
                 radial-gradient(circle at 70% 60%, rgba(251,113,133,.35), transparent 55%);
      filter:blur(24px);
      transform:rotate(25deg);
      pointer-events:none;
    }
    .headline{font-size:34px;line-height:1.1;margin:10px 0 8px}
    .lede{color:var(--muted);margin:0 0 16px}
    .video{
      aspect-ratio:16/9;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      border: 1px solid rgba(0,0,0,.08);
    /*background: #f2f4f3; */
      background:#000;     /* looks better behind a video */
      position: relative; /* <--  this line */
    }
    /* Responsive Vimeo wrapper */
    .video .vimeo-embed{
      position:relative;
      width:100%;
      padding-top:56.25%; /* 16:9 */
    }
    .video .vimeo-embed iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }
    
    .video img, .video video{width:100%;height:100%;object-fit:cover;display:block}

    .form-card{
      padding:22px;border-radius:18px;background:var(--glass);
      background: var(--glass);
      border: 1px solid rgba(0,0,0,.08);
    }
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input, select, textarea{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      background:#ffffff;
      color:var(--text);
      outline:none;
    }

    /* light-themed dropdown (closed + opened list) */
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
    
      background-color:#ffffff;
      color:var(--text);
      border:1px solid rgba(0,0,0,.12);
    
      /* custom arrow (dark ink) */
      background-image:url("data:image/svg+xml;utf8,<svg fill='%230f1b14' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
      background-repeat:no-repeat;
      background-position:right 12px center;
      background-size:18px;
      padding-right:38px;
    }
    select option{
      background-color:#ffffff;
      color:var(--text);
    }
    select option:first-child{ color:#9ca3af; } /* placeholder look */
    select:focus{
      outline:2px solid var(--accent2);
      outline-offset:2px;
    }

    /* Hide placeholder text while the field is focused */
    input:focus::placeholder,
    textarea:focus::placeholder {
      color: transparent;     /* or: opacity: 0; */
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 520px){.row{grid-template-columns:1fr}}

    .btn{
      appearance:none;border:0;border-radius:12px;padding:13px 16px;width:100%;
      font-weight:800;letter-spacing:.02em;cursor:pointer;color:#05101a;
      background:linear-gradient(135deg, var(--accent2), var(--accent1));
      box-shadow:0 10px 28px rgba(108,194,74,.35), 0 6px 18px rgba(155,216,79,.25);
      transition:transform .05s ease;
      margin-top:10px
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}

    .consent{
      display:flex;
      align-items:center;   /* vertically center checkbox with first line of text */
      gap:12px;
      margin-top:10px;
    }
    
    .consent input{
      width:auto;
      margin:0;             /* remove default offset */
      transform: translateY(1px);  /* tiny nudge so it sits on the text baseline */
    }
    
    .consent label{
      line-height:1.35;     /* comfortable multi-line spacing */
    }
    
    .err{color:var(--err);font-size:12px;display:none}
    .ok{color:var(--ok);font-size:13px;display:none;margin-top:8px}

    .partners{
      margin-top:18px;padding:16px;border-radius:14px;background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1)
    }
    .partners h3{font-size:12px;color:var(--muted);margin:0 0 10px;letter-spacing:.08em;text-transform:uppercase}
    .logos{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
      gap:24px;                      /* even spacing between logos */
      place-items:center;            /* center inside each cell */
      padding-top:8px;
    }
    .logos img{
      height:72px;                   /* uniform visual size */
      max-width:160px;               /* prevents super-wide logos from stretching */
      width:100%;
      object-fit:contain;
      background:#fff;
      border-radius:8px;
      padding:10px;                  /* consistent white border around all logos */
      box-shadow:0 0 0 1px rgba(0,0,0,.06) inset; /* subtle edge so it doesn’t “stick” to the card */
    }
    @media (max-width: 780px){.logos{grid-template-columns:repeat(3,1fr)}}
    @media (max-width: 480px){.logos{grid-template-columns:repeat(2,1fr)}}
    footer{margin:24px 0 8px;text-align:center;color:var(--muted);font-size:12px}
    a{color:#d2e4ff}
    /* Footer privacy link styling (overrides generic a{}) */
    footer a#privacyLink{
      color: var(--muted);
      text-decoration: none;
    }
    footer a#privacyLink:hover{
      text-decoration: underline;
    }
    
    /* language switcher */
    .lang-switch{display:flex;gap:8px}
    .lang{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);
      background:rgba(255,255,255,.05);color:var(--text);cursor:pointer;font-weight:700}
    .lang.active{background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#07120a;border-color:transparent}
      
      /* automatically add a red * after required labels */
    label[for="name"]::after,
    label[for="email"]::after {
      content: " *";
      color: #b91c1c;   /* red */
      font-weight: 700;
    }
    
    /* --- success tick + message --- */
    .success-wrap {
      display: none;
      align-items: flex-start;
      gap: 10px;
      padding: 14px 16px;
      margin-top: 14px;
      border-radius: 10px;
      background: #f0fdf4; /* light green background */
      border: 1px solid #bbf7d0; /* soft green border */
    }

    /* When we add .show in JS, it becomes visible and animates the checkbox */
    .success-wrap.show{ display:flex; }
    
    .success-texts {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    #successText {
      font-weight: 600;
      color: #065f46; /* dark green */
      font-size: 15px;
    }
    
    #successHint {
      font-size: 13px;
      color: #374151; /* muted dark gray */
      opacity: 0.9;
    }

    .checkmark{
      width:42px;height:42px;border-radius:50%;
      border:3px solid #22c55e;       /* green ring */
      position:relative; display:inline-block;
      animation:cm-pop .35s ease-out;
    }
    .checkmark::after{
      content:"";
      position:absolute; left:10px; top:14px;
      width:10px; height:18px;
      border-right:3px solid #22c55e;
      border-bottom:3px solid #22c55e;
      transform:rotate(45deg);
      opacity:0;
      animation:cm-draw .45s ease-out .15s forwards;
    }
    
    @keyframes cm-pop{
      0%{transform:scale(.7);opacity:0}
      100%{transform:scale(1);opacity:1}
    }
    @keyframes cm-draw{
      to{opacity:1}
    }

    /* Checkbox animation */
    .checkbox {display:inline-block;margin-right:10px;}
    .checkbox svg {stroke: var(--accent2);stroke-width: 3;fill: none;}
    .checkbox .box {stroke: #ccc;stroke-width: 2;fill: white;transition: stroke 0.3s ease;}
    .checkbox .tick {
      stroke-dasharray: 30;
      stroke-dashoffset: 30;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: stroke-dashoffset 0.4s ease;
    }
    
    /* Animate when parent .success-wrap is visible */
    .success-wrap.show .checkbox .box {stroke: var(--accent2);}
    .success-wrap.show .checkbox .tick {stroke-dashoffset: 0;}

    /* Overlay endcard styling */
    .endcard{
      position:absolute;
      inset:0;
      display:none;            /* hidden by default */
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.75);
      color:#fff;
      z-index:2;
      border-radius:16px;      /* match video corners */
    }
    .endcard-inner{ text-align:center; }
    .endcard-title{ font-size:20px; font-weight:700; margin-bottom:12px; }
    .replay-btn{
      background:#6cc24a; color:#fff; border:none; border-radius:8px;
      padding:10px 16px; cursor:pointer; font-weight:600; font-size:14px;
      transition:background .2s ease;
    }
    .replay-btn:hover{ background:#5aad3f; }
    
    /* When the overlay is showing, dim + slightly blur the Vimeo iframe behind it */
    .video.dim .vimeo-embed iframe{
      filter: brightness(0.35) blur(2px);
      transition: filter .25s ease;
      pointer-events: none; /* avoid clicks on the iframe while overlay is up */
    }
    
    /* Ensure the overlay only shows when we add the .dim state */
    .video .endcard{ display:none; }
    .video.dim .endcard{ display:flex; }

  </style>
  
</head>
<body>
  <div class="shell">
    <!-- Header / Logo -->
    <header>
      <div class="brand">
        <!-- 🔁 Replace with your project logo URL -->
        <img src="RenoChain_Logo_500X.png" alt="RenoChain logo" />
        <div>
          <h1 class="tag" style="margin:0; font-weight:800; letter-spacing:.05em;">RenoChain</h1>
          <div class="tag" id="site-subtitle">Million Program Renovation — Video Showcase</div>
        </div>
      </div>
      <!-- EN/SV language switcher -->
      <div class="lang-switch" role="group" aria-label="Language">
        <button type="button" data-lang="en" class="lang active">EN</button>
        <button type="button" data-lang="sv" class="lang">SV</button>
      </div>
    </header>

        <!-- Main Title -->
    <h2 id="page_title" style="text-align:center; margin:0 0 12px; font-weight:800;">
      Industrialized Energy Renovation — Video Showcase
    </h2>

    <!-- Hero & Form -->
    <section class="hero">
      <div class="teaser">
        <div class="headline" id="headline">Unlock the full-length video</div>
        <p class="lede" id="lede">A deep dive into scalable, cost-efficient renovation — methods, partners, and lessons learned.</p>
        
        <div class="video" id="teaserBox" aria-label="Teaser video">
        <div class="vimeo-embed">
          <iframe
            id="teaserVideo"
            src="https://player.vimeo.com/video/1120087399?h=ec76700423&badge=0&autopause=1&muted=1&playsinline=1"
            title="RenoChain - teaser video"
            allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            loading="lazy"
            frameborder="0"
            allowfullscreen
          ></iframe>
        </div>
      
        <!-- 🔽 New overlay -->
        <div id="endcard" class="endcard">
          <div class="endcard-inner">
            <div class="endcard-title">Thanks for watching!</div>
            <button class="replay-btn" id="replayBtn">⟳ Replay</button>
          </div>
        </div>
      </div>

        <!-- Partners -->
        <div class="partners">
          <h3 id="collab">In collaboration with</h3>
          <div class="logos">
            <img src="WFT.png" alt="Partner WFT" />
            <img src="STC.png" alt="Partner STC" />
            <img src="SABO.jpg" alt="Partner SABO" />
            <img src="SWEA.png" alt="Partner SEA" />
          </div>
        </div>
      </div>

      <div class="form-card">
        <form id="gateForm" novalidate>
          <label for="name" id="label-name">Full name</label>
          <input id="name" name="name" placeholder="Jane Doe" required />
          <div class="err" data-err="name"></div>

          <div class="row">
            <div>
              <label for="email" id="label-email">Work email</label>
              <input id="email" name="email" type="email" placeholder="jane@acme.se" required />
              <div class="err" data-err="email"></div>
            </div>
            <div>
              <label for="phone" id="label-phone">Phone</label>
              <input id="phone" name="phone" type="tel" placeholder="+46 70 123 45 67" />
              <div class="err" data-err="phone"></div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="company" id="label-company">Company</label>
              <input id="company" name="company" placeholder="Acme AB" />
              <div class="err" data-err="company"></div>
            </div>
            <div>
              <label for="role" id="label-role">Role</label>
              <select id="role" name="role">
                <option value="" id="role-placeholder">Select your role</option>
                <option>CEO / Founder</option>
                <option>Operations</option>
                <option>Procurement</option>
                <option>Project Manager</option>
                <option>Engineer</option>
                <option>Sales / Marketing</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <label for="notes" id="label-notes">What are you hoping to learn?</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Optional"></textarea>

          <div class="consent">
            <input type="checkbox" id="consent" name="consent" required />
            <label for="consent" id="consent-text">I agree to the processing of my personal data for accessing this content and follow-up about related services.</label>
          </div>
          <div class="err" data-err="consent"></div>

          <!-- Honeypot for bots -->
          <input type="text" name="website" id="website" class="hp" style="position:absolute;left:-9999px;top:-9999px" tabindex="-1" autocomplete="off" />

          <!-- Hidden attribution fields (auto-filled by JS) -->
          <input type="hidden" name="landing_url" id="landing_url" />
          <input type="hidden" name="user_agent" id="user_agent" />
          <input type="hidden" name="ip" id="ip" />
          <input type="hidden" name="Language" id="Language" />
        
          <button class="btn" type="submit" id="submit-btn">Unlock & Watch</button>
          <div id="success" class="success-wrap" role="status" aria-live="polite" style="display:none;">
          <span class="checkbox" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5" class="box"/>
              <polyline points="6,12 10,16 18,8" class="tick"/>
            </svg>
          </span>
          <div class="success-texts">
            <div id="successText"></div>
            <div id="successHint"></div>
          </div>
        </div>
        <!-- Post-submit CTA (hidden by default; shown after success) -->
        <div id="watchCta" style="display:none; margin-top:12px;">
        <button type="button" id="watchBtn" class="btn">
          <!-- label will be set by JS based on language -->
          Unlock & Watch
        </button>
        </div>
        </form>
      </div>
    </section>

    <footer>
      © <span id="yr"></span> RenoChain — All rights reserved. · 
      <a id="privacyLink" href="/privacy.html" target="_blank" rel="noopener noreferrer">Privacy</a>
    </footer>
  </div>
  
  <!-- Vimeo API (optional, only needed if you’ll control play/pause via JS later) -->
  <script defer src="https://player.vimeo.com/api/player.js"></script>

<script>

  const PRIVACY_URL = "/privacy.html";   // or "https://campaign.renochain.se/privacy.html"
  // --- Language dictionary (EN/SV) ---
  const i18n = {
    en: {
      headline: "Unlock the full-length video",
      page_title: "Industrialized Energy Renovation — Video Showcase",
      site_subtitle: "Industrialized Energy Renovation — Video Showcase",
      lede: "Discover the industrialized energy renovation of the future – faster, cheaper, and more sustainable with RenoChain's digital process.",
      collab: "In collaboration with",
      "label-name": "Full name",
      "label-email": "Work email",
      "label-phone": "Phone",
      "label-company": "Company",
      "label-role": "Role",
      "label-notes": "What are you hoping to learn?",
      "role-placeholder": "Select your role",
      "consent_html":'I consent to my personal data being processed in accordance with the <a href="{URL}" target="_blank" rel="noopener noreferrer">privacy policy</a> and to receiving newsletters and information about services and offers from RenoChain. You can unsubscribe at any time via the link in our emails.',
      "submit-btn": "Unlock & Watch",
      ph_name: "Jane Doe",
      ph_email: "jane@acme.se",
      ph_phone: "+46 70 123 45 67",
      ph_company: "Acme AB",
      ph_notes: "Optional",
      roles: ["CEO / Founder","Operations","Procurement","Project Manager","Engineer","Sales / Marketing","Other"],
      success_msg: "Thank you {NAME}!. Please check your inbox for the video link.",
      success_hint: "If you don’t see the email soon, please also check your spam or junk folder.",
      privacy_label: "Privacy policy"
    },
    sv: {
      headline: "Lås upp hela videon",
      page_title: "Industrialisierad energirenovering — Video Showcase",
      site_subtitle: "Industrialisierad energirenovering — Video Showcase",
      lede: "Upptäck framtidens industrialiserade energirenovering – snabbare, billigare och hållbarare med RenoChains digitala process.",
      collab: "I samarbete med",
      "label-name": "Fullständigt namn",
      "label-email": "Arbetsmejl",
      "label-phone": "Telefon",
      "label-company": "Företag",
      "label-role": "Roll",
      "label-notes": "Vad vill du få ut?",
      "role-placeholder": "Välj din roll",
      "consent_html":'Jag samtycker till att mina personuppgifter behandlas enligt <a href="{URL}" target="_blank" rel="noopener noreferrer">integritetspolicyn</a> och att jag får nyhetsbrev och information om tjänster och erbjudanden från RenoChain. Du kan när som helst avregistrera dig via länken i våra utskick.',
      "submit-btn": "Lås upp och titta",
      ph_name: "Anna Svensson",
      ph_email: "anna@acme.se",
      ph_phone: "+46 70 123 45 67",
      ph_company: "Acme AB",
      ph_notes: "Valfritt",
      roles: ["VD / Grundare","Drift","Inköp","Projektledare","Ingenjör","Sälj / Marknad","Annat"],
      success_msg: "Tack {NAME}!. Kontrollera din inkorg för videolänken.",
      success_hint: "Om du inte ser e-postmeddelandet snart, titta även i din skräppostmapp.",
      privacy_label: "Integritetspolicy",
    }
  };

  // ========= CONFIG: Replace with your values =========
  const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbzA0Xe1K2pbpH_ox1T-P7gKrwbSvGk4mh2mmWV74OtxaRkB_4Z8HVTj8zdKYeEVwbiwwg/exec";
  // ======= Where to send users after successful submit =======
  const VIDEO_URL_EN = "https://campaign.renochain.se/video-eng/";   // TODO: replace with your English page URL
  const VIDEO_URL_SV = "https://campaign.renochain.se/video-sv/";   // TODO: replace with your Swedish page URL
  
  // Lightweight analytics helper (safe no-op if libs are missing)
  function track(eventName, payload){
    try {
      if (window.gtag) window.gtag('event', eventName, payload || {});
      if (window.plausible) window.plausible(eventName, { props: payload || {} });
    } catch {}
  }
  
  // Fill year
  document.getElementById('yr').textContent = new Date().getFullYear();

  // ---- Language handling (+ write hidden Language field) ----
  function setLanguageField(langCode) {
    const el = document.getElementById("Language");
    if (!el) return;
    el.value = (langCode === "sv") ? "Swedish" : "English";
  }

  function applyI18n(lang){
    const dict = i18n[lang] || i18n.en;
    const ids = [
      "headline","lede","collab",
      "label-name","label-email","label-phone","label-company","label-role","label-notes",
      "consent-text","submit-btn","role-placeholder",
      "site-subtitle","page_title"
    ];
    ids.forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      if(id === "role-placeholder") { el.textContent = dict[id]; return; }
      if (id === "consent-text") {
        el.innerHTML = (dict.consent_html || "").replace("{URL}", PRIVACY_URL);
        return;
      }
      el.textContent = dict[id];
    });

    // placeholders
    const setPh = (id, val) => { const el = document.getElementById(id); if (el) el.placeholder = val; };
    setPh("name", dict.ph_name);
    setPh("email", dict.ph_email);
    setPh("phone", dict.ph_phone);
    const company = document.getElementById("company"); if (company) company.placeholder = dict.ph_company;
    const notesEl = document.getElementById("notes");   if (notesEl) notesEl.placeholder = dict.ph_notes;

    // roles
    const roleSel = document.getElementById("role");
    if(roleSel){
      const placeholder = roleSel.querySelector("option#role-placeholder");
      roleSel.innerHTML = "";
      if (placeholder) roleSel.appendChild(placeholder);
      (dict.roles || []).forEach(r=>{
        const opt = document.createElement("option");
        opt.textContent = r;
        roleSel.appendChild(opt);
      });
    }

    // footer privacy text
    const pLink = document.getElementById("privacyLink");
    if (pLink) {
      pLink.textContent = dict.privacy_label || "Privacy";
      pLink.href = PRIVACY_URL;
    }
    
    document.documentElement.lang = lang;
    localStorage.setItem("renochain_lang", lang);

    // Button active state
    document.querySelectorAll(".lang").forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.lang === lang);
    });

    // Write hidden Language field for the sheet
    setLanguageField(lang);
  }

  // init language
  (function initLang(){
    const saved = localStorage.getItem("renochain_lang");
    const fallback = (navigator.language || "en").toLowerCase().startsWith("sv") ? "sv" : "en";
    applyI18n(saved || fallback);

    document.addEventListener("click", (e)=>{
      const btn = e.target.closest(".lang");
      if(!btn) return;
        const newLang = btn.dataset.lang;
        applyI18n(newLang);
      // 👇 NEW: if the post-submit CTA is visible, update its label to match the new language
      const ctaWrap = document.getElementById("watchCta");
      const watchBtn = document.getElementById("watchBtn");
      if (ctaWrap && watchBtn && ctaWrap.style.display !== "none") {
        const dictNow = i18n[newLang] || i18n.en;
        watchBtn.textContent = dictNow["submit-btn"] || "Unlock & Watch";
      }
    });
  })();

  // ---- Minimal context fields you still keep ----
  // landing_url + user_agent are trivial; ip via ipapi
  (function setContextBasics(){
    const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val || ""; };
    set("landing_url", location.href);
    set("user_agent", navigator.userAgent || "");
  })();

  // Fetch public IP (best-effort)
  let ipReady = (async function fillIP(){
    try {
      const resp = await fetch("https://ipapi.co/json/");
      if (!resp.ok) return;
      const d = await resp.json();
      const ipEl = document.getElementById("ip");
      if (ipEl) ipEl.value = d.ip || "";
    } catch(e) {
      console.warn("IP lookup failed", e);
    }
  })();

  // ---- Form handling ----
  const emailOk = v => /.+@.+\..+/.test(v);
  const phoneOk = v => !v || /^(\+\d{6,15}|\d{6,15}|\(\+?\d+\)[\d\s-]+)$/.test(v);

  const form = document.getElementById("gateForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Wait a moment for IP if still pending (non-blocking safety)
    try { await Promise.race([ipReady, new Promise(r=>setTimeout(r, 1200))]); } catch {}

    const data = new FormData(form);

    // Honeypot
    if (data.get("website")) return;

    // Validate
    const errs = {};
    if (!(data.get("name")||"").trim()) errs.name = "Please enter your name.";
    if (!emailOk(data.get("email")||"")) errs.email = "Enter a valid email.";
    if (!(data.get("company")||"").trim()) errs.company = "Please enter your company.";
    if (!phoneOk(data.get("phone")||"")) errs.phone = "Enter a valid phone, or leave blank.";
    if (!form.consent.checked) errs.consent = "Consent is required.";

    document.querySelectorAll(".err").forEach(el => el.style.display = "none");
    Object.entries(errs).forEach(([k,msg])=>{
      const el = document.querySelector(`.err[data-err="${k}"]`);
      if (el){ el.textContent = msg; el.style.display = "block"; }
    });
    if (Object.keys(errs).length) return;

    console.log("FormData keys:", [...data.keys()]);
    console.log("FormData entries (sample):", 
      ["landing_url", data.get("landing_url")],
      ["user_agent",  data.get("user_agent")],
      ["ip",          data.get("ip")],
      ["Language",    data.get("Language")]
    );

    // Submit to Apps Script and show success (no redirect)
    try{
      await fetch(ENDPOINT_URL, { method:"POST", mode:"no-cors", body:data });

      // Determine current language
      const saved = localStorage.getItem("renochain_lang");
      const fallback = (navigator.language || "en").toLowerCase().startsWith("sv") ? "sv" : "en";
      const lang = saved || fallback;
      const dict = i18n[lang] || i18n.en;

      // Personalize with name if present
      const rawName = (data.get("name") || "").trim();
      const namePart = rawName ? `, ${rawName}` : "";
      const msg = (dict.success_msg || "Thank you. Please check your inbox for the video link.")
                    .replace("{NAME}", namePart);

      // Disable inputs to prevent double submits
      const btn = document.getElementById("submit-btn");
      if (btn) { btn.disabled = true; btn.style.opacity = .7; btn.style.cursor = "default"; }
      form.querySelectorAll("input, select, textarea").forEach(el => el.disabled = true);

      // Show tick + message
      const success = document.getElementById("success");
      const successTextEl = document.getElementById("successText");
      const successHintEl = document.getElementById("successHint");
      if (successTextEl) successTextEl.textContent = msg;
      if (successHintEl) successHintEl.textContent = dict.success_hint || "";
      if (success) {
        success.style.display = "flex";
        success.classList.add("show");
        success.scrollIntoView({ behavior: "smooth", block: "center" });
      }
      // === Show the post-submit "Unlock & Watch" button and route correctly ===
      const ctaWrap = document.getElementById("watchCta");
      const watchBtn = document.getElementById("watchBtn");
      if (ctaWrap && watchBtn) {
        // Set the button label in the current language (reuse your i18n submit label)
        watchBtn.textContent = dict["submit-btn"] || "Unlock & Watch";
        // Make sure it's visible
        ctaWrap.style.display = "block";
        // Move focus to the CTA for quick keyboard/AT access
        try { watchBtn.focus({ preventScroll: true }); } catch {}
        // IMPORTANT: ensure the button is enabled even though we disabled inputs
        watchBtn.disabled = false;
        watchBtn.style.opacity = 1;
        watchBtn.style.cursor = "pointer";
        // Click -> route to language-specific page
        watchBtn.onclick = () => {
          // Prevent rapid double clicks
          if (watchBtn.dataset.busy === "1") return;
          watchBtn.dataset.busy = "1";
          watchBtn.disabled = true;
          
          watchBtn.style.opacity = 0.8;
          watchBtn.style.cursor = "default";
          watchBtn.textContent = (langNow === "sv") ? "Öppnar…" : "Opening…";
          // Re-read language at click time (handles late language switching)
          const savedNow = localStorage.getItem("renochain_lang");
          const fallNow = (navigator.language || "en").toLowerCase().startsWith("sv") ? "sv" : "en";
          const langNow = savedNow || fallNow;
        
          const dest = (langNow === "sv") ? VIDEO_URL_SV : VIDEO_URL_EN;
          if (!dest || dest === "/video/en.html" || dest === "/video/sv.html") {
            // Fallback: if you forgot to replace the placeholders, alert and don’t navigate
            try {
              alert(langNow === "sv"
                ? "Videolänken är inte konfigurerad ännu."
                : "The video link isn’t configured yet.");
            } catch {}
            // Reset busy/disabled so user can try again later
            watchBtn.dataset.busy = "0";
            watchBtn.disabled = false;
            return;
          }
          // NEW: analytics event (safe if analytics libs aren’t present)
          track("watch_cta_click", { lang: langNow, dest });
          window.location.href = dest;
        };
      }
    }catch(err){
      const saved = localStorage.getItem("renochain_lang");
      const fallback = (navigator.language || "en").toLowerCase().startsWith("sv") ? "sv" : "en";
      const lang = saved || fallback;
      alert(lang === "sv"
        ? "Något gick fel när formuläret skickades. Försök igen."
        : "Something went wrong submitting the form. Please try again.");
      console.error(err);
    }
  });

  // ===== Vimeo endcard control =====
  (function setupEndcard(){
    // Grab elements by the IDs we agreed on
    const iframe    = document.getElementById('teaserVideo');   // <-- match your HTML
    const overlay   = document.getElementById('endcard');
    const replayBtn = document.getElementById('replayBtn');
    const teaserBox = document.getElementById('teaserBox');
  
    if (!iframe || !overlay || !replayBtn || !teaserBox) return;
  
    const init = () => {
      if (!window.Vimeo || !window.Vimeo.Player) return;
      const player = new Vimeo.Player(iframe);
  
      const show = () => { 
        teaserBox.classList.add('dim'); 
        overlay.style.display = 'flex'; 
      };
      const hide = () => { 
        overlay.style.display = 'none'; 
        teaserBox.classList.remove('dim'); 
      };
  
      // Show the overlay when video ends; hide when playing/seeked
      player.on('ended', show);
      player.on('play', hide);
      player.on('seeked', hide);
  
      // Replay button: hide overlay, rewind, play
      replayBtn.addEventListener('click', async () => {
        hide();
        try {
          await player.setCurrentTime(0);
          await player.play();
        } catch (e) { /* ignore */ }
      });
    };
  
    // Player.js is loaded with "defer". If it's not ready, run after window load.
    if (document.readyState === 'complete') {
      init();
    } else {
      window.addEventListener('load', init, { once: true });
    }
  })();

</script>
</body>
</html>
